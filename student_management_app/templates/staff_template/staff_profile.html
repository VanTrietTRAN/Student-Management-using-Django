{% extends 'staff_template/base_template.html' %}
{% load static %}
{% block page_title %}
Chỉnh sửa thông tin cá nhân
{% endblock page_title %}
{% block main_content %}
    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
          <div class="row">
              <!-- Profile Info Card -->
              <div class="col-md-4">
                  <div class="card card-primary card-outline">
                      <div class="card-body box-profile">
                          <div class="text-center">
                              {% if user.staffs.admin.profile_pic %}
                              <img class="profile-user-img img-fluid img-circle" 
                                   src="{{ user.staffs.admin.profile_pic.url }}" 
                                   alt="User profile picture"
                                   style="width: 150px; height: 150px; object-fit: cover;">
                              {% else %}
                              <img class="profile-user-img img-fluid img-circle" 
                                   src="{% static 'dist/img/user2-160x160.jpg' %}" 
                                   alt="User profile picture">
                              {% endif %}
                          </div>
                          <h3 class="profile-username text-center">{{ user.first_name }} {{ user.last_name }}</h3>
                          <p class="text-muted text-center">{{ user.username }}</p>
                          
                          <ul class="list-group list-group-unbordered mb-3">
                              <li class="list-group-item">
                                  <b>Email</b> <a class="float-right">{{ user.email }}</a>
                              </li>
                              <li class="list-group-item">
                                  <b>Địa chỉ</b> <a class="float-right">{{ user.staffs.address }}</a>
                              </li>
                              <li class="list-group-item">
                                  <b>Số môn giảng dạy</b> <a class="float-right">{{ subjects_count }}</a>
                              </li>
                          </ul>
                      </div>
                  </div>
              </div>
              
              <!-- Edit Form -->
              <div class="col-md-8">
                  <div class="card card-primary">
                      <div class="card-header">
                          <h3 class="card-title">Chỉnh sửa thông tin cá nhân</h3>
                      </div>
                      
                      <form role="form" action="{% url 'staff_profile_save' %}" method="post" enctype="multipart/form-data">
                          {% csrf_token %}
                          <div class="card-body">
                              {% if messages %}
                                  {% for message in messages %}
                                  {% if message.tags == 'error' %}
                                  <div class="alert alert-danger alert-dismissible fade show">
                                      <button type="button" class="close" data-dismiss="alert">&times;</button>
                                      {{ message }}
                                  </div>
                                  {% endif %}
                                  {% if message.tags == 'success' %}
                                  <div class="alert alert-success alert-dismissible fade show">
                                      <button type="button" class="close" data-dismiss="alert">&times;</button>
                                      {{ message }}
                                  </div>
                                  {% endif %}
                                  {% endfor %}
                              {% endif %}
                              
                              <div class="form-group">
                                  <label>Username</label>
                                  <input type="text" class="form-control" value="{{ user.username }}" disabled>
                                  <small class="form-text text-muted">Username không thể thay đổi</small>
                              </div>
                              
                              <div class="form-group">
                                  <label>Email</label>
                                  <input type="text" class="form-control" value="{{ user.email }}" disabled>
                                  <small class="form-text text-muted">Email không thể thay đổi</small>
                              </div>
                              
                              <div class="row">
                                  <div class="col-md-6">
                                      <div class="form-group">
                                          <label>Họ và tên đệm <span class="text-danger">*</span></label>
                                          <input type="text" class="form-control" name="first_name" value="{{ user.first_name }}" required>
                                      </div>
                                  </div>
                                  <div class="col-md-6">
                                      <div class="form-group">
                                          <label>Tên <span class="text-danger">*</span></label>
                                          <input type="text" class="form-control" name="last_name" value="{{ user.last_name }}" required>
                                      </div>
                                  </div>
                              </div>
                              
                              <div class="form-group">
                                  <label>Địa chỉ</label>
                                  <textarea class="form-control" name="address" rows="2">{{ user.staffs.address }}</textarea>
                              </div>
                              
                              <div class="form-group">
                                  <label>Ảnh đại diện</label>
                                  <div class="custom-file">
                                      <input type="file" class="custom-file-input" id="customFile" name="profile_pic" accept="image/*">
                                      <label class="custom-file-label" for="customFile">Chọn ảnh...</label>
                                  </div>
                                  <small class="form-text text-muted">Định dạng: JPG, PNG, GIF. Kích thước tối đa: 2MB</small>
                              </div>
                              
                              <div class="form-group">
                                  <label>Đổi mật khẩu</label>
                                  <input type="password" class="form-control" name="password" placeholder="Chỉ điền nếu muốn đổi mật khẩu">
                                  <small class="form-text text-muted">Để trống nếu không muốn thay đổi mật khẩu</small>
                              </div>
                          </div>
                          
                          <div class="card-footer">
                              <button type="submit" class="btn btn-primary">
                                  <i class="fas fa-save"></i> Lưu thay đổi
                              </button>
                              <a href="{% url 'staff_home' %}" class="btn btn-secondary">
                                  <i class="fas fa-times"></i> Hủy
                              </a>
                          </div>
                      </form>
                  </div>
              </div>
          </div>
      </div>
    </section>
    
    <script>
    // Update file input label when file is selected
    document.querySelector('.custom-file-input').addEventListener('change', function(e) {
        var fileName = e.target.files[0].name;
        var nextSibling = e.target.nextElementSibling;
        nextSibling.innerText = fileName;
    });
    </script>
{% endblock main_content %}

